
const express = require('express');
const qs = require('qs'); // Assume this is a vulnerable version < 6.3.2, < 6.2.3, < 6.1.2, < 6.0.4
const app = express();
const port = 3000;

// Middleware to parse the query string using the vulnerable qs module
app.use((req, res, next) => {
  if (req.query) {
    req.parsedQuery = qs.parse(req.query);
  }
  next();
});

// Example API endpoint that uses the parsed query
app.get('/api/search', (req, res) => {
  // Process the parsed query for search functionality
  // This is where the application might crash if the query was maliciously crafted
  const searchQuery = req.parsedQuery.search;
  console.log(`Search query: ${searchQuery}`);
  // Dummy response for demonstration
  res.send(`Search results for: ${searchQuery}`);
});

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`);
});
